# –í—ã–¥–µ–ª–µ–Ω–∏–µ –ª–∏–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–º –≤—ã—á–∏—Ç–∞–Ω–∏—è —Ñ–æ–Ω–∞ (Background Subtraction)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –≤—ã–¥–µ–ª–µ–Ω–∏—è –ª–∏–Ω–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è –¥–≤–∞ –∫–∞–¥—Ä–∞:
- **Background** - –∫–∞–¥—Ä –ë–ï–ó –ª–∏–Ω–∏–∏ (–ø—É—Å—Ç–æ–µ –ø–æ–ª–µ)
- **Foreground** - –∫–∞–¥—Ä –° –ª–∏–Ω–∏–µ–π

–†–µ–∑—É–ª—å—Ç–∞—Ç: —á–∏—Å—Ç–∞—è –±–∏–Ω–∞—Ä–Ω–∞—è –º–∞—Å–∫–∞ –ª–∏–Ω–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

## üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**Background Subtraction (–≤—ã—á–∏—Ç–∞–Ω–∏–µ —Ñ–æ–Ω–∞)** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è:

```
–ú–∞—Å–∫–∞_–ª–∏–Ω–∏–∏ = Foreground - Background
```

–ü—Ä–∏ –≤—ã—á–∏—Ç–∞–Ω–∏–∏ —Ñ–æ–Ω–∞ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏, —Ç–æ –µ—Å—Ç—å **–ª–∏–Ω–∏—è**.

## üìã –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

–°–∫—Ä–∏–ø—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç **6 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤** –≤—ã–¥–µ–ª–µ–Ω–∏—è –ª–∏–Ω–∏–∏:

### 1. ü•á –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
diff = foreground - background
mask = diff > threshold
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–∞–∏–±–æ–ª–µ–µ —á–∏—Å—Ç–∞—è –º–∞—Å–∫–∞ (–∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å = 1.0)
- ‚úÖ –û–¥–Ω–∞ —Å–≤—è–∑–Ω–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ª–∏–Ω–∏–∏)
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (~20%)
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–º–Ω—ã—Ö –ª–∏–Ω–∏–π –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ß–µ—Ä–Ω–∞—è –ª–∏–Ω–∏—è –Ω–∞ –±–µ–ª–æ–º –ø–æ–ª–µ (–Ω–∞—à —Å–ª—É—á–∞–π)
- –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
- –ù—É–∂–Ω–∞ —á–∏—Å—Ç–∞—è –º–∞—Å–∫–∞ –±–µ–∑ —à—É–º–∞

### 2. –ê–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞

```python
diff = |foreground - background|
mask = diff > threshold
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å–≤–µ—Ç–ª—ã—Ö –∏ —Ç–µ–º–Ω—ã—Ö –ª–∏–Ω–∏–π)
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ë–æ–ª—å—à–µ —à—É–º–∞ (19 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–º–µ—Å—Ç–æ 1)
- ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (~55%)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω —Ü–≤–µ—Ç –ª–∏–Ω–∏–∏ (—Å–≤–µ—Ç–ª–∞—è –∏–ª–∏ —Ç–µ–º–Ω–∞—è)
- –î–æ–ø—É—Å—Ç–∏–º –Ω–µ–±–æ–ª—å—à–æ–π —à—É–º

### 3. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥

```python
diff = |foreground - background|
mask = adaptiveThreshold(diff)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –Ω–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω–æ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –û—á–µ–Ω—å –º–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (370!)
- ‚ùå –ù–∏–∑–∫–∞—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å (0.26)
- ‚ùå –ú–∞—Å–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –°–∏–ª—å–Ω–æ–µ –Ω–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
- –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã —è—Ä–∫–æ—Å—Ç–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏

### 4. –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
diff = |foreground - background|
mask = threshold(diff)
mask = opening(mask)  # –£–¥–∞–ª—è–µ—Ç —à—É–º
mask = closing(mask)  # –ó–∞–ø–æ–ª–Ω—è–µ—Ç –¥—ã—Ä—ã
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –º–µ–ª–∫–∏–π —à—É–º
- ‚úÖ –ó–∞–ø–æ–ª–Ω—è–µ—Ç –¥—ã—Ä—ã –≤ –ª–∏–Ω–∏–∏
- ‚úÖ –•–æ—Ä–æ—à–∞—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å (0.94)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (~55%)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç "—Ä–∞–∑–º—ã—Ç—å" —Ç–æ–Ω–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –õ–∏–Ω–∏—è –∏–º–µ–µ—Ç —Ä–∞–∑—Ä—ã–≤—ã
- –ú–Ω–æ–≥–æ –º–µ–ª–∫–æ–≥–æ —à—É–º–∞
- –ù—É–∂–Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –º–∞—Å–∫–∞

### 5. –ù–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

```python
std_bg = std(background)
threshold = num_std * std_bg
mask = diff > threshold
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥ (—É—á–∏—Ç—ã–≤–∞–µ—Ç —à—É–º —Ñ–æ–Ω–∞)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (8.7%)
- ‚ö†Ô∏è –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (7)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —á–∞—Å—Ç—å –ª–∏–Ω–∏–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —à—É–º–∞
- –ù—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –¥–µ—Ç–µ–∫—Ü–∏–∏

### 6. CLAHE-—É–ª—É—á—à–µ–Ω–Ω—ã–π

```python
diff = |foreground - background|
diff_enhanced = CLAHE(diff)  # –£–ª—É—á—à–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞—Å—Ç
mask = threshold(diff_enhanced)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–ª—É—á—à–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞—Å—Ç
- ‚úÖ –í—ã—è–≤–ª—è–µ—Ç —Å–ª–∞–±—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –û—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (84%)
- ‚ùå –ú–Ω–æ–≥–æ —à—É–º–∞ (24 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- ‚ùå –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ª–∏—à–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç –ª–∏–Ω–∏–∏
- –õ–∏–Ω–∏—è —Å–ª–∞–±–æ –≤–∏–¥–Ω–∞

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç: –ö–∞–ª–∏–±—Ä–æ–≤–æ—á–Ω—ã–π –∫–∞–¥—Ä vs –ö–∞–¥—Ä —Å –ª–∏–Ω–∏–µ–π

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- Background: `calibration_20251109_155647_232_005.jpg`
- Foreground: `straight_20251108_233731_584_005.jpg`
- –†–∞–∑–º–µ—Ä: 160√ó120 px

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –ú–µ—Ç–æ–¥ | –ü–æ–∫—Ä—ã—Ç–∏–µ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å | –ë–∞–ª–ª |
|-------|----------|-----------|--------------|------|
| ü•á **–ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ** | 20.87% | 1 | **1.000** | **0.865** |
| ü•à –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ | 54.67% | 2 | 0.940 | 0.598 |
| ü•â Std –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è | 8.68% | 7 | 0.509 | 0.541 |
| –ê–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ | 54.62% | 19 | 0.920 | 0.532 |
| CLAHE | 84.07% | 24 | 0.987 | 0.502 |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥ | 12.26% | 370 | 0.263 | 0.415 |

### –í—ã–≤–æ–¥—ã:

‚úÖ **–õ–£–ß–®–ò–ô –ú–ï–¢–û–î: –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ**

**–ü–æ—á–µ–º—É:**
- –ò–¥–µ–∞–ª—å–Ω–∞—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å (1.0) - –æ–¥–Ω–∞ —Å–≤—è–∑–Ω–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (20.87%) - —Ç–æ–ª—å–∫–æ –ª–∏–Ω–∏—è, –±–µ–∑ —à—É–º–∞
- –ù–∞–∏–≤—ã—Å—à–∏–π –æ–±—â–∏–π –±–∞–ª–ª (0.865)
- –°–∞–º–∞—è —á–∏—Å—Ç–∞—è –º–∞—Å–∫–∞

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd test
pip install -r requirements.txt  # numpy, pillow, matplotlib, opencv-python
```

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
python3 extract_line_background_subtraction.py background.jpg foreground.jpg
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
python3 extract_line_background_subtraction.py \
    ../data/img_calibration/calibration_20251109_155647_232_005.jpg \
    ../data/img_straight/straight_20251108_233731_584_005.jpg
```

### –í—ã–≤–æ–¥

```
ü•á –†–µ–π—Ç–∏–Ω–≥ –º–µ—Ç–æ–¥–æ–≤ (–ø–æ –∫–∞—á–µ—Å—Ç–≤—É –º–∞—Å–∫–∏):

  ü•á –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ              –ë–∞–ª–ª: 0.865
  ü•à –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏       –ë–∞–ª–ª: 0.598
  ü•â –ù–∞ –æ—Å–Ω–æ–≤–µ std –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è       –ë–∞–ª–ª: 0.541
  ...

üí° –õ–£–ß–®–ò–ô –ú–ï–¢–û–î: –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ
   –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —á–∏—Å—Ç—É—é –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –º–∞—Å–∫—É –ª–∏–Ω–∏–∏.
```

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

–°–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª `test/output/line_extraction_comparison.png` —Å:
- **–°—Ç—Ä–æ–∫–∞ 1:** Foreground —Å –Ω–∞–ª–æ–∂–µ–Ω–Ω–æ–π –º–∞—Å–∫–æ–π (–∫—Ä–∞—Å–Ω—ã–º)
- **–°—Ç—Ä–æ–∫–∞ 2:** –ß–∏—Å—Ç—ã–µ –º–∞—Å–∫–∏ –æ—Ç –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–°—Ç—Ä–æ–∫–∞ 3:** –ò—Å—Ö–æ–¥–Ω—ã–µ Background –∏ Foreground –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏

–°–∫—Ä–∏–ø—Ç –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–π –º–∞—Å–∫–∏ –ø–æ —Ç—Ä–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:

### 1. –ü–æ–∫—Ä—ã—Ç–∏–µ (Coverage)
- **–ß—Ç–æ:** –ü—Ä–æ—Ü–µ–Ω—Ç –ø–∏–∫—Å–µ–ª–µ–π –≤ –º–∞—Å–∫–µ
- **–û–ø—Ç–∏–º—É–º:** 10-25% –¥–ª—è —Ç–∏–ø–∏—á–Ω–æ–π –ª–∏–Ω–∏–∏
- **–ü—Ä–æ–±–ª–µ–º—ã:**
  - –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ–µ (<5%) - –ø—Ä–æ–ø—É—â–µ–Ω–∞ —á–∞—Å—Ç—å –ª–∏–Ω–∏–∏
  - –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ–µ (>50%) - –∑–∞—Ö–≤–∞—á–µ–Ω –ª–∏—à–Ω–∏–π —à—É–º

### 2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (Components)
- **–ß—Ç–æ:** –ß–∏—Å–ª–æ —Å–≤—è–∑–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π –≤ –º–∞—Å–∫–µ
- **–û–ø—Ç–∏–º—É–º:** 1 (–æ–¥–Ω–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –ª–∏–Ω–∏—è)
- **–ü—Ä–æ–±–ª–µ–º—ã:**
  - –ú–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç - —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞
  - –ù—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 3. –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å (Compactness)
- **–§–æ—Ä–º—É–ª–∞:** `–∫—Ä—É–ø–Ω–µ–π—à–∞—è_–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ / –æ–±—â–µ–µ_–ø–æ–∫—Ä—ã—Ç–∏–µ`
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0-1
- **–û–ø—Ç–∏–º—É–º:** 1.0 (–≤—Å—è –º–∞—Å–∫–∞ - –æ–¥–Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
- **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
  - 1.0 = –∏–¥–µ–∞–ª—å–Ω–æ (–æ–¥–Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
  - 0.8-1.0 = —Ö–æ—Ä–æ—à–æ (–¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç –æ–¥–Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
  - <0.5 = –ø–ª–æ—Ö–æ (–º–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤)

### –ò—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª

```python
–±–∞–ª–ª = (
    –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å √ó 0.5 +
    –±–∞–ª–ª_–ø–æ–∫—Ä—ã—Ç–∏—è √ó 0.3 +
    –±–∞–ª–ª_–∫–æ–º–ø–æ–Ω–µ–Ω—Ç √ó 0.2
)
```

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å > –ø–æ–∫—Ä—ã—Ç–∏–µ > –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–æ–±–æ—Ç–∞ –ú–∏–∫–†–æ–ë–ë–æ–∫—Å

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—á–∏—Ç–∞–Ω–∏–µ**

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –°–Ω—è—Ç—å –∫–∞–¥—Ä –ø—É—Å—Ç–æ–≥–æ –ø–æ–ª—è (background) –ø—Ä–∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–µ
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å background –≤ –ø–∞–º—è—Ç–∏
3. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ:
   - –ó–∞—Ö–≤–∞—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–∞–¥—Ä (foreground)
   - –í—ã—á–µ—Å—Ç—å: `diff = foreground - background`
   - –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å: `diff = -diff` (–¥–ª—è —Ç–µ–º–Ω–æ–π –ª–∏–Ω–∏–∏)
   - –ü–æ—Ä–æ–≥: `mask = diff > 20`
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å–∫—É –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –ª–∏–Ω–∏–∏

**–ö–æ–¥ –Ω–∞ C++ (ESP32):**
```cpp
// –ó–∞—Ö–≤–∞—Ç background –ø—Ä–∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–µ
uint8_t background[160*120];
camera_fb_t* fb = esp_camera_fb_get();
memcpy(background, fb->buf, 160*120);

// –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ
camera_fb_t* fb_current = esp_camera_fb_get();
uint8_t mask[160*120];

for (int i = 0; i < 160*120; i++) {
    int16_t diff = background[i] - fb_current->buf[i]; // –¢–µ–º–Ω–∞—è –ª–∏–Ω–∏—è
    mask[i] = (diff > 20) ? 255 : 0;
}

// mask —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ª–∏–Ω–∏—é
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–ï—Å–ª–∏ –ª–∏–Ω–∏—è —Å–≤–µ—Ç–ª–∞—è (–±–µ–ª–∞—è):**
```python
diff = foreground - background  # –ë–ï–ó –∏–Ω–≤–µ—Ä—Å–∏–∏
mask = diff > threshold
```

**–ï—Å–ª–∏ —Ü–≤–µ—Ç –ª–∏–Ω–∏–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω:**
```python
diff = cv2.absdiff(background, foreground)
mask = diff > threshold
```

**–ï—Å–ª–∏ –º–Ω–æ–≥–æ —à—É–º–∞:**
```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
mask = simple_subtraction(bg, fg)
kernel = np.ones((3,3), np.uint8)
mask = cv2.morphologyEx(mask, cv2.MORPH_OPEN, kernel)
mask = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ü–æ—Ä–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (threshold)

**–î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—á–∏—Ç–∞–Ω–∏—è:**
```python
method_simple_subtraction(bg, fg, threshold=20)
```

- **–ù–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ (10-15):** –ë–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π, –±–æ–ª—å—à–µ —à—É–º–∞
- **–°—Ä–µ–¥–Ω–∏–π –ø–æ—Ä–æ–≥ (20-30):** –ë–∞–ª–∞–Ω—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–í—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ (40+):** –ú–µ–Ω—å—à–µ —à—É–º–∞, –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–ª–∞–±—ã–µ —É—á–∞—Å—Ç–∫–∏

### –†–∞–∑–º–µ—Ä –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —è–¥—Ä–∞

**–î–ª—è –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
```python
method_morphological(bg, fg, kernel_size=3)
```

- **–ú–∞–ª–µ–Ω—å–∫–æ–µ —è–¥—Ä–æ (3√ó3):** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–µ—Ç–∞–ª–∏
- **–°—Ä–µ–¥–Ω–µ–µ —è–¥—Ä–æ (5√ó5):** –ë–∞–ª–∞–Ω—Å
- **–ë–æ–ª—å—à–æ–µ —è–¥—Ä–æ (7√ó7+):** –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ std –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π

**–î–ª—è –º–µ—Ç–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ std:**
```python
method_stddev_based(bg, fg, num_std=2.0)
```

- **–ù–∏–∑–∫–æ–µ (1.5-2.0):** –ë–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è
- **–°—Ä–µ–¥–Ω–µ–µ (2.0-2.5):** –ë–∞–ª–∞–Ω—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **–í—ã—Å–æ–∫–æ–µ (3.0+):** –¢–æ–ª—å–∫–æ –æ—á–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–µ—Ç–µ–∫—Ü–∏–∏

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –° –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–º –ª–∏–Ω–∏–∏

```python
# 1. –ü–æ–ª—É—á–∏—Ç—å –º–∞—Å–∫—É –ª–∏–Ω–∏–∏
mask = method_simple_subtraction(background, foreground)

# 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å test_line_detection.py
from test_line_detection import detect_line_position

result = detect_line_position(foreground, mask=mask)
position = result['position']
```

### –° –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π —Ä–æ–±–æ—Ç–∞

```python
# 1. –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ (—Å–Ω—è—Ç—å background)
background = capture_empty_field()

# 2. –í —Ä–∞–±–æ—á–µ–º —Ü–∏–∫–ª–µ
while True:
    foreground = camera.capture()
    mask = extract_line(background, foreground)
    
    position = calculate_line_position(mask)
    
    if position < -0.15:
        robot.turn_left()
    elif position > 0.15:
        robot.turn_right()
    else:
        robot.go_straight()
```

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å background subtraction

- ‚ùå –§–æ–Ω –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è (–¥–≤–∏–∂—É—â–∏–µ—Å—è –æ–±—ä–µ–∫—Ç—ã)
- ‚ùå –ò–∑–º–µ–Ω—è–µ—Ç—Å—è –æ—Å–≤–µ—â–µ–Ω–∏–µ
- ‚ùå –ö–∞–º–µ—Ä–∞ –¥–≤–∏–∂–µ—Ç—Å—è (–º–µ–Ω—è–µ—Ç—Å—è –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞)

–í —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- –ü–æ—Ä–æ–≥–æ–≤—É—é –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—é (Otsu, –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é)
- –î–µ—Ç–µ–∫—Ü–∏—é –∫—Ä–∞–µ–≤ (Canny, Sobel)
- –¶–≤–µ—Ç–æ–≤—É—é —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é (HSV, Lab)

### –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ø–æ–ª–Ω—è–µ—Ç:
- **test_line_detection.py** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Å–∫—É –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏
- **evaluate_frame_differences.py** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞
- **compare_camera_heights.py** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é –∫–∞–º–µ—Ä—ã

## ‚ùì FAQ

**–í: –ù—É–∂–Ω–æ –ª–∏ —Å–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–π background –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–µ–∑–¥–æ–º?**

–û: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –æ—Å–≤–µ—â–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω background, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏—è —Å—Ç–∞–±–∏–ª—å–Ω—ã.

**–í: –ß—Ç–æ –µ—Å–ª–∏ —Ñ–æ–Ω –Ω–µ–æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–π?**

–û: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –º–µ—Ç–æ–¥ "–ù–∞ –æ—Å–Ω–æ–≤–µ std –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è" - –æ–Ω –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º.

**–í: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ background –∫–∞–¥—Ä–æ–≤?**

–û: –î–∞! –£—Å—Ä–µ–¥–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–¥—Ä–æ–≤ –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ background:
```python
background = np.mean([load(f) for f in bg_files], axis=0).astype(np.uint8)
```

**–í: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—Ç—å background?**

–û: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Å–≤–µ—â–µ–Ω–∏—è –∏–ª–∏ –ø–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—è (>5 –º–∏–Ω—É—Ç).

## üìö –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

- Background Subtraction: [OpenCV Documentation](https://docs.opencv.org/master/d1/dc5/tutorial_background_subtraction.html)
- Morphological Operations: [OpenCV Morphological Transformations](https://docs.opencv.org/master/d9/d61/tutorial_py_morphological_ops.html)
- CLAHE: [Contrast Limited AHE](https://docs.opencv.org/master/d5/daf/tutorial_py_histogram_equalization.html)
