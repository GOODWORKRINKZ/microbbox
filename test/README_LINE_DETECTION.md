# –¢–µ—Å—Ç—ã –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ª–∏–Ω–∏–∏

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º `detectLinePosition()` –∏–∑ `LinerRobot.cpp` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–Ω–∏–º–∫–∞—Ö —Å –∫–∞–º–µ—Ä—ã —Ä–æ–±–æ—Ç–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
data/
‚îú‚îÄ‚îÄ camera_config.json      # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã (hMirror, vFlip)
‚îú‚îÄ‚îÄ img_straight/          # –õ–∏–Ω–∏—è –ø—Ä—è–º–æ (–æ–∂–∏–¥–∞–µ—Ç—Å—è ~0.0)
‚îú‚îÄ‚îÄ img_left/              # –õ–∏–Ω–∏—è —Å–ª–µ–≤–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è < 0)
‚îú‚îÄ‚îÄ img_right/             # –õ–∏–Ω–∏—è —Å–ø—Ä–∞–≤–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è > 0)
‚îî‚îÄ‚îÄ img terminate/         # –ö–æ–Ω–µ—Ü –ª–∏–Ω–∏–∏ (T-–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∏–ª–∏ –æ–±—Ä—ã–≤)
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r test/requirements.txt
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
pip install numpy pillow matplotlib
```

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python test/test_line_detection.py
```

## –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏

–ê–ª–≥–æ—Ä–∏—Ç–º –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ `LinerRobot.cpp`:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ grayscale, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –¥–æ 160x120
2. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∫–∞–º–µ—Ä—ã**: hMirror –∏ vFlip –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–Ω–∏–∏**: –ê–Ω–∞–ª–∏–∑ –ø–∏–∫—Å–µ–ª–µ–π –Ω–∞ 75% –≤—ã—Å–æ—Ç—ã –∫–∞–¥—Ä–∞
4. **–ü–æ—Ä–æ–≥–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü–∏–∫—Å–µ–ª–∏ > 128 —Å—á–∏—Ç–∞—é—Ç—Å—è "–ª–∏–Ω–∏–µ–π"
5. **–†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–∏**: –°—Ä–µ–¥–Ω—è—è –ø–æ–∑–∏—Ü–∏—è –±–µ–ª—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫ [-1.0, 1.0]
6. **–î–µ—Ç–µ–∫—Ü–∏—è –∫–æ–Ω—Ü–∞ –ª–∏–Ω–∏–∏**:
   - –û–±—Ä—ã–≤: –Ω–µ—Ç –±–µ–ª—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
   - T-–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: –ª–∏–Ω–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç >70% —à–∏—Ä–∏–Ω—ã –∫–∞–¥—Ä–∞

## –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–∏–∑ hardware_config.h)

- `LINE_CAMERA_WIDTH = 160` - —à–∏—Ä–∏–Ω–∞ –∫–∞–¥—Ä–∞
- `LINE_CAMERA_HEIGHT = 120` - –≤—ã—Å–æ—Ç–∞ –∫–∞–¥—Ä–∞ (FRAMESIZE_QQVGA)
- `LINE_THRESHOLD = 128` - –ø–æ—Ä–æ–≥ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –±–µ–ª—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
- `LINE_T_JUNCTION_THRESHOLD = 0.7` - –ø–æ—Ä–æ–≥ –¥–ª—è T-–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è (70%)

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–¢–µ—Å—Ç –≤—ã–≤–æ–¥–∏—Ç:
- **Position**: –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ª–∏–Ω–∏–∏ [-1.0 .. 1.0]
  - `-1.0` - –∫—Ä–∞–π–Ω–∏–π –ª–µ–≤—ã–π –∫—Ä–∞–π
  - `0.0` - —Ü–µ–Ω—Ç—Ä
  - `+1.0` - –∫—Ä–∞–π–Ω–∏–π –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π
- **Detected**: –Ω–∞–π–¥–µ–Ω–∞ –ª–∏ –ª–∏–Ω–∏—è (true/false)
- **Width**: –ø—Ä–æ—Ü–µ–Ω—Ç —à–∏—Ä–∏–Ω—ã –∫–∞–¥—Ä–∞, –∑–∞–Ω—è—Ç—ã–π –ª–∏–Ω–∏–µ–π
- **Terminate**: –æ–±–Ω–∞—Ä—É–∂–µ–Ω –ª–∏ –∫–æ–Ω–µ—Ü –ª–∏–Ω–∏–∏

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

–ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `matplotlib`, —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –ø–∞–ø–∫–µ `test/output/`:
- –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏ –∫–∞–º–µ—Ä—ã
- –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å –Ω–∞–ª–æ–∂–µ–Ω–∏–µ–º:
  - –ö—Ä–∞—Å–Ω–∞—è –ª–∏–Ω–∏—è - scan line (75% –≤—ã—Å–æ—Ç—ã)
  - –ó–µ–ª–µ–Ω–∞—è –ª–∏–Ω–∏—è - —Ü–µ–Ω—Ç—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π –ª–∏–Ω–∏–∏
  - –°—Ç—Ä–µ–ª–∫–∞ - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (LEFT/RIGHT)
  - –¢–µ–∫—Å—Ç - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

1. –°–¥–µ–ª–∞–π—Ç–µ —Å–Ω–∏–º–∫–∏ —Å –∫–∞–º–µ—Ä—ã —Ä–æ–±–æ—Ç–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö
2. –†–∞–∑–ª–æ–∂–∏—Ç–µ –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø–∞–ø–∫–∞–º:
   - `img_straight/` - –ª–∏–Ω–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É
   - `img_left/` - —Ä–æ–±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞–ª–µ–≤–æ
   - `img_right/` - —Ä–æ–±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–≤–µ—Ä–Ω—É—Ç—å –Ω–∞–ø—Ä–∞–≤–æ
   - `img terminate/` - –∫–æ–Ω–µ—Ü —Ç—Ä–∞—Å—Å—ã
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `camera_config.json` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–µ–∫—É—â–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Ä–æ–±–æ—Ç–∞

## –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```
üì∑ stream1.jpeg:
   Position: -0.245
   Detected: True
   Width: 8.1%
   Terminate: False
   ‚úÖ PASS - –ü–æ–∑–∏—Ü–∏—è –≤ –æ–∂–∏–¥–∞–µ–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ [-1.0, -0.1]
```

## –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã –≤ `camera_config.json`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `hMirror` –∏ `vFlip` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Ä–æ–±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∫–æ–Ω—Ç—Ä–∞—Å—Ç, –æ—Å–≤–µ—â–µ–Ω–∏–µ)
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `LINE_THRESHOLD` –µ—Å–ª–∏ –ª–∏–Ω–∏—è –ø–ª–æ—Ö–æ —Ä–∞–∑–ª–∏—á–∏–º–∞
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º
