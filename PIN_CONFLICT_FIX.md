# Конфликт пинов ESP32CAM и решение

## Проблема

После прошивки Liner-робота устройство не стартует. Лог показывает сбой загрузки.

## Причина

**Конфликт пинов:**
- Пин 16 (GPIO16) был назначен и для бузера (`BUZZER_PIN`), и для кнопки (`BUTTON_PIN`)
- GPIO16 на ESP32CAM используется для PSRAM и может конфликтовать с другими функциями
- При включенной камере, использование GPIO16 вызывает проблемы при загрузке

## Решение

### Отключение бузера

Временно отключен бузер во всех типах роботов:

```cpp
// target_config.h - TARGET_CLASSIC
// #define FEATURE_BUZZER    // Звуковые эффекты (ОТКЛЮЧЕНО: конфликт пинов)
```

### Перемещение кнопки

Кнопка (для Liner) перемещена с GPIO16 на GPIO4:

```cpp
// hardware_config.h
#ifdef FEATURE_BUTTON
    #define BUTTON_PIN 4    // Кнопка на пин 4 (GPIO4, безопасный пин)
#endif
```

## Безопасные пины ESP32CAM

### Занятые пины (НЕ использовать)

**Камера (AI-Thinker):**
- GPIO0 - XCLK
- GPIO5 - Y2
- GPIO18 - Y3
- GPIO19 - Y4
- GPIO21 - Y5
- GPIO22 - PCLK
- GPIO23 - HREF
- GPIO25 - VSYNC
- GPIO26 - SIOD
- GPIO27 - SIOC
- GPIO32 - PWDN
- GPIO34 - Y8 (input only)
- GPIO35 - Y9 (input only)
- GPIO36 - Y6 (input only)
- GPIO39 - Y7 (input only)

**Моторы (Scout32 конфигурация):**
- GPIO12 - Motor Left Forward
- GPIO13 - Motor Left Reverse
- GPIO14 - Motor Right Forward
- GPIO15 - Motor Right Reverse

**NeoPixel:**
- GPIO2 - Адресные светодиоды (3 шт)

**Системные:**
- GPIO1 - UART TX (Serial)
- GPIO3 - UART RX (Serial)
- GPIO16 - PSRAM (НЕ использовать!)

### Свободные пины (можно использовать)

**GPIO4** - ✅ Используется для кнопки (Liner)
- Input/Output
- Безопасен для использования
- Нет конфликтов с камерой/PSRAM

**GPIO33** - ✅ Встроенный LED
- Output only
- Может использоваться для индикации

**GPIO9, GPIO10** - ⚠️ Подключены к Flash
- Обычно не используются
- Могут вызвать проблемы

## Рекомендации по назначению пинов

### Для бузера (когда потребуется)

Безопасные варианты:
1. **GPIO33** - если не нужен встроенный LED
2. **GPIO4** - если кнопка не используется (Brain, Classic)

### Для дополнительных кнопок/сенсоров

**GPIO4** - первый выбор для входов

### Для дополнительных выходов

**GPIO33** - для индикации/управления

## Текущая конфигурация пинов

```
ESP32CAM (AI-Thinker) - МикРоББокс 0.1.0

Камера:         GPIO0,5,18,19,21-27,32,34-36,39
Моторы:         GPIO12-15
NeoPixel:       GPIO2
Кнопка (Liner): GPIO4
LED (встр.):    GPIO33
Serial:         GPIO1,3

Свободно:       - (все основные заняты)
Конфликт:       GPIO16 (PSRAM - НЕ использовать!)
```

## История изменений

**v0.1.0 (2025-11-03):**
- Отключен бузер из-за конфликта с GPIO16
- Кнопка перемещена с GPIO16 на GPIO4
- Добавлена документация о пинах

## TODO

- [ ] Найти безопасный пин для бузера
- [ ] Протестировать GPIO33 для бузера
- [ ] Рассмотреть использование I2C expander для дополнительных пинов

---

**Дата:** 2025-11-03  
**Версия:** 0.1.0
