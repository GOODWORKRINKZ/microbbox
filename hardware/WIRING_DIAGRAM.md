# МикРоББокс - Схема подключения

## 📐 Полная схема соединений

```
                           МикРоББокс Wiring Diagram
                           
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                         Источник питания                                │
│                     ┌──────────────────────┐                            │
│                     │  LiPo 1S (3.7V)      │                            │
│                     │  или 5V источник     │                            │
│                     └──────┬────────┬──────┘                            │
│                            │        │                                   │
│                           5V       GND                                  │
│                            │        │                                   │
└────────────────────────────┼────────┼───────────────────────────────────┘
                             │        │
         ┌───────────────────┴────────┴──────────────────┐
         │                                                │
         │              ┌──────────────┐                  │
         │              │   ESP32-CAM  │                  │
         │              │  (AI Thinker)│                  │
         │              └──────────────┘                  │
         │                                                │
    ┌────┴────┐                                      ┌────┴────┐
    │   5V    │                                      │   GND   │
    └─────────┘                                      └─────────┘
         │                                                │
         │                                                │
    ┌────┴────────────────────────────────────────────────┴────┐
    │                                                           │
    │                    ESP32-CAM Pinout                       │
    │                                                           │
    │  GPIO2  ──────────┐                                       │
    │  GPIO12 ──┐       │                                       │
    │  GPIO13 ──┼──┐    │                                       │
    │  GPIO14 ──┼──┼──┐ │                                       │
    │  GPIO15 ──┼──┼──┼─┼──┐                                    │
    │  GPIO16 ──┼──┼──┼─┼──┼──┐                                 │
    │           │  │  │ │  │  │                                 │
    └───────────┼──┼──┼─┼──┼──┼─────────────────────────────────┘
                │  │  │ │  │  │
                │  │  │ │  │  └──────> Бузер/Buzzer
                │  │  │ │  │
                │  │  │ │  └─────────> RIGHT Motor REV (IN4)
                │  │  │ │
                │  │  │ └────────────> RIGHT Motor FWD (IN3)
                │  │  │
                │  │  └─────────────> LEFT Motor REV (IN2)
                │  │
                │  └────────────────> LEFT Motor FWD (IN1)
                │
                └───────────────────> NeoPixel WS2812B (DIN)
```

## 🔌 Детальная схема подключения

### 1. ESP32-CAM основные соединения

```
        ESP32-CAM
     ┌─────────────┐
     │             │
5V ──┤ 5V          │
GND ─┤ GND         │
     │             │
     │   GPIO2   ──┼──> NeoPixel Data IN
     │   GPIO12  ──┼──> MX1508 IN1 + Pull-down 10kΩ
     │   GPIO13  ──┼──> MX1508 IN2 + Pull-down 10kΩ
     │   GPIO14  ──┼──> MX1508 IN4 + Pull-down 10kΩ
     │   GPIO15  ──┼──> MX1508 IN3 + Pull-down 10kΩ
     │   GPIO16  ──┼──> Buzzer +
     │             │
     └─────────────┘
```

### 2. MX1508 Motor Driver с Pull-down резисторами

```
ESP32-CAM                Резистор              MX1508
                        (10kΩ)
                        
GPIO12 ────┬───────────────────────────────> IN1 (Левый FWD)
           │
           └─────────── 10kΩ ──────────────> GND

GPIO13 ────┬───────────────────────────────> IN2 (Левый REV)
           │
           └─────────── 10kΩ ──────────────> GND

GPIO15 ────┬───────────────────────────────> IN3 (Правый FWD)
           │
           └─────────── 10kΩ ──────────────> GND

GPIO14 ────┬───────────────────────────────> IN4 (Правый REV)
           │
           └─────────── 10kΩ ──────────────> GND


       MX1508 Driver
    ┌──────────────────┐
VM ─┤ VM           OUT1├──> Левый мотор +
GND─┤ GND          OUT2├──> Левый мотор -
    │                  │
    │              OUT3├──> Правый мотор +
    │              OUT4├──> Правый мотор -
    └──────────────────┘
    
Питание моторов (VM): 3-7V (обычно от LiPo 1S 3.7V)
```

### 3. NeoPixel WS2812B светодиоды (цепочка)

```
            NeoPixel LED Chain (3 LEDs)
            
ESP32             LED #1          LED #2          LED #3
GPIO2 ────────> DIN     DOUT ──> DIN     DOUT ──> DIN
                 │                │                │
                VCC              VCC              VCC
                 │                │                │
                5V               5V               5V
                 │                │                │
                GND              GND              GND
                 │                │                │
               ──┴────────────────┴────────────────┴──
                                GND

Расположение: LED #1 и #2 - задние (эффекты)
              LED #3 - передний (фонарик)
```

### 4. Бузер (два варианта подключения)

#### Вариант A: Прямое подключение (простое)
```
ESP32 GPIO16 ────────> Бузер (+)
                       Бузер (-) ────> GND
```

#### Вариант B: С транзистором NPN (рекомендуется, громче)
```
ESP32                   NPN (2N2222)          Бузер
                       
GPIO16 ──┬─── 1kΩ ───> Base
         │              │
         │            Collector ────────────> Бузер (+)
         │              │
         │            Emitter ──────────────> GND
         │
       (PWM)
       
Бузер (-) подключен к VCC (3.3V или 5V)
```

### 5. Схема питания (рекомендуемая)

```
                    Основная система питания
                    
    ┌───────────────────────────────────────────────────┐
    │                                                   │
    │  LiPo Battery 1S (3.7V, 500-1000mAh)              │
    │  ┌─────────────────┐                              │
    │  │      + │ -      │                              │
    │  └────────┼─┼──────┘                              │
    │           │ │                                     │
    │      ┌────┴─┴────┐                                │
    │      │ ON/OFF SW │                                │
    │      └────┬─┬────┘                                │
    │           │ │                                     │
    │           │ └───────────────────────────> GND     │
    │           │                                  │    │
    │           ├──────────┐                       │    │
    │           │          │                       │    │
    │      ┌────▼────┐     │                       │    │
    │      │Diode    │     │                       │    │
    │      │1N5819   │     │                       │    │
    │      └────┬────┘     │                       │    │
    │           │          │                       │    │
    │      ┌────▼────────┐ │                       │    │
    │      │ 220µF Cap   │ │                       │    │
    │      └────┬────────┘ │                       │    │
    │           │          │                       │    │
    │           ├──────────┴──────> VM (MX1508)    │    │
    │           │                                  │    │
    │      ┌────▼──────────┐                       │    │
    │      │Buck Converter │                       │    │
    │      │  3.7V -> 5V   │                       │    │
    │      └────┬──────────┘                       │    │
    │           │                                  │    │
    │      ┌────▼────────┐                         │    │
    │      │  100µF Cap  │                         │    │
    │      └────┬────────┘                         │    │
    │           │                                  │    │
    │           ├─────────────────> 5V (ESP32-CAM) │    │
    │           ├─────────────────> 5V (NeoPixel)  │    │
    │           │                                  │    │
    │           └──────────────────────────────────┴────┘
    │                                             GND    │
    └───────────────────────────────────────────────────┘

Конденсаторы развязки:
- 100µF электролит на 5V ESP32
- 220µF электролит на VM моторов
- 100nF керамика возле каждой микросхемы
```

## 📋 Пины ESP32-CAM - полная таблица

| GPIO | Назначение | Примечание |
|------|------------|------------|
| GPIO0 | XCLK | Камера (тактовый сигнал) |
| GPIO2 | NeoPixel DIN | **STRAPPING PIN** - должен быть LOW при загрузке |
| GPIO5 | Y2 | Камера (данные) |
| GPIO12 | Motor L FWD (IN1) | **Требует pull-down 10kΩ** |
| GPIO13 | Motor L REV (IN2) | **Требует pull-down 10kΩ** |
| GPIO14 | Motor R REV (IN4) | **Требует pull-down 10kΩ** |
| GPIO15 | Motor R FWD (IN3) | **STRAPPING PIN + pull-down 10kΩ** |
| GPIO16 | Buzzer | Активный или с PWM |
| GPIO18 | Y3 | Камера (данные) |
| GPIO19 | Y4 | Камера (данные) |
| GPIO21 | Y5 | Камера (данные) |
| GPIO22 | PCLK | Камера (пиксельный тактовый) |
| GPIO23 | HREF | Камера (горизонтальная синхронизация) |
| GPIO25 | VSYNC | Камера (вертикальная синхронизация) |
| GPIO26 | SIOD | Камера (I2C данные) |
| GPIO27 | SIOC | Камера (I2C тактовый) |
| GPIO32 | PWDN | Камера (power down) |
| GPIO33 | LED встроенный | Вспышка камеры (не используется) |
| GPIO34 | Y8 | Камера (данные, только вход) |
| GPIO35 | Y9 | Камера (данные, только вход) |
| GPIO36 | Y6 | Камера (данные, только вход) |
| GPIO39 | Y7 | Камера (данные, только вход) |

## ⚠️ ВАЖНО: Критические моменты

### 1. Pull-down резисторы для MX1508 (ОБЯЗАТЕЛЬНЫ!)

MX1508 имеет высокое входное сопротивление (~100kΩ). Без pull-down резисторов:
- При Reset пины ESP32 находятся в floating состоянии
- Моторы могут непреднамеренно вращаться
- Возможны хаотичные движения при включении питания

**Решение**: Установите резисторы 10kΩ от каждого управляющего пина (GPIO12-15) к GND

### 2. Strapping pins

- **GPIO2** (NeoPixel): Должен быть LOW при загрузке. NeoPixel не мешает загрузке.
- **GPIO15** (Motor): Должен быть LOW при загрузке. Pull-down резистор обеспечивает это.

### 3. Развязка по питанию

**Обязательно установите**:
- Конденсатор 100µF на питании ESP32 (5V к GND)
- Конденсатор 220µF на питании моторов (VM к GND)
- Керамические конденсаторы 100nF возле каждой микросхемы

Это защищает от:
- Скачков напряжения при запуске моторов
- Помех в цепи питания
- Сброса ESP32 при старте моторов

### 4. Защита от переполюсовки

Установите диод Шоттки (1N5819) на линию питания:
```
Battery (+) ──┬──|>|──> System (+)
              │
         Protection
```

### 5. Общая земля (GND)

**Критически важно**: Все компоненты должны иметь общую землю:
- ESP32-CAM GND
- MX1508 GND
- NeoPixel GND
- Buzzer GND
- Источник питания GND

## 🧪 Контрольный список перед первым включением

- [ ] Проверены все соединения мультиметром
- [ ] Установлены все 4 pull-down резистора 10kΩ на GPIO12-15
- [ ] Установлены конденсаторы развязки
- [ ] Проверена полярность подключения питания
- [ ] Общая земля соединена для всех компонентов
- [ ] Моторы отключены от ESP32 (для первого теста)
- [ ] Измерено напряжение питания (должно быть 5V на ESP32)
- [ ] Проверена изоляция всех соединений

## 📝 Тестирование после сборки

### Шаг 1: Проверка питания
1. Подайте питание
2. Убедитесь, что моторы НЕ крутятся
3. Проверьте напряжение на ESP32 (должно быть 5V)

### Шаг 2: Проверка ESP32
1. Подключите USB-программатор
2. Загрузите тестовую прошивку
3. Проверьте Serial Monitor (115200 baud)

### Шаг 3: Проверка компонентов
1. **NeoPixel**: Должны загореться при запуске
2. **Buzzer**: Проверьте командой из веб-интерфейса
3. **Motors**: Протестируйте управление

### Шаг 4: Проверка при Reset
1. Нажмите кнопку Reset на ESP32-CAM
2. Убедитесь, что моторы НЕ крутятся
3. Проверьте, что все компоненты работают после перезагрузки

---

**Дата обновления**: 2025-11-01  
**Версия**: 1.0  
**Автор**: МикРоББокс Team
