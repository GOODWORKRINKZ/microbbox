# Обновление от 2025-11-02

## Исправлены проблемы с тестированием моторов и управлением

### 1. Увеличена мощность тестирования моторов ✅
**Было:** Тест моторов работал на 50% мощности  
**Стало:** Тест моторов работает на 100% мощности

Это позволяет лучше проверить работоспособность моторов и правильность настроек.

### 2. Настройки моторов теперь применяются при тестировании ✅
**Было:** При тестировании моторов настройки (инверсия, смена местами) НЕ применялись  
**Стало:** Тест моторов использует ту же функцию `setMotorSpeed()`, что и обычное управление

Теперь при тестировании моторов:
- ✅ Применяется инверсия левого мотора (если включена)
- ✅ Применяется инверсия правого мотора (если включена)
- ✅ Применяется смена местами лево/право (если включена)

**Зачем это нужно:**
Ранее было невозможно понять, правильно ли настроены моторы, потому что тест шел напрямую к железу, игнорируя настройки. Теперь тест показывает реальное поведение робота с учетом всех настроек.

### 3. Добавлено логирование настроек при тесте ✅
В Serial Monitor теперь выводится информация при каждом тесте:
```
========== НАСТРОЙКИ МОТОРОВ ==========
Смена местами лево/право: НЕТ
Инверсия левого мотора: ДА
Инверсия правого мотора: НЕТ
Тестируемый мотор: left
Направление: forward
Мощность: 100%
=======================================
```

Это помогает убедиться, что настройки применяются правильно.

### 4. Исправлено залипание движения ✅
**Проблема:** После отпускания стиков робот продолжал ехать (залипание)  
**Причина:** Команда остановки (0, 0) не отправлялась из-за throttling механизма  
**Решение:** Команда остановки теперь всегда отправляется немедленно, игнорируя throttling

**Техническое объяснение:**
В JavaScript был механизм throttling, который предотвращал отправку команд чаще чем раз в 50ms или при изменении скорости менее чем на 5%. Когда пользователь отпускал стики, значения становились 0, но если недавно уже была отправлена команда с малой скоростью, команда остановки не отправлялась, и робот продолжал движение.

**Исправление в `resources/script.js`:**
```javascript
// ВАЖНО: Всегда отправляем команду остановки (0, 0) чтобы предотвратить залипание
const isStopCommand = (leftSpeed === 0 && rightSpeed === 0);
const wasMoving = (this.lastLeftSpeed !== 0 || this.lastRightSpeed !== 0);

// Отправляем если:
// 1. Это команда остановки после движения (предотвращает залипание)
// 2. Прошло >= 50ms с последней отправки
// 3. Скорость изменилась на >5%
if ((isStopCommand && wasMoving) || timeSinceLastSend >= this.movementThrottle || speedChanged) {
    // отправка команды
}
```

## Файлы изменены
- `src/MicroBoxRobot.cpp` - тест моторов и логирование
- `resources/script.js` - исправление залипания движения

## Тестирование
Для проверки изменений:
1. Откройте веб-интерфейс робота
2. Перейдите в настройки моторов
3. Включите/выключите различные опции (инверсия, смена местами)
4. Запустите тест моторов и проверьте Serial Monitor для логов
5. Проверьте, что тест моторов ведет себя так же, как обычное управление
6. Проверьте управление стиками - робот должен останавливаться сразу после отпускания
