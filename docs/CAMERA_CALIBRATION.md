# –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã –¥–ª—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ –ª–∏–Ω–∏–∏

## –û–±–∑–æ—Ä

–ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏ –ª–∏–Ω–∏–∏ –≤ –ú–∏–∫—Ä–æ–ë–æ–∫—Å –õ–∞–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–ª–∏–±—Ä–æ–≤–∫—É –∫–∞–º–µ—Ä—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∏ –ø–æ–≤—ã—à–∞—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ –ª–∏–Ω–∏–∏.

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

–í —Ñ–∞–π–ª–µ `include/hardware_config.h` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```cpp
// –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –Ω–∞–±–ª—é–¥–∞–µ–º–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞)
#define LINE_PIXELS_PER_CM_WIDTH 16.0f   // –ü–∏–∫—Å–µ–ª–µ–π –Ω–∞ 1 —Å–º –ø–æ —à–∏—Ä–∏–Ω–µ –∫–∞–¥—Ä–∞
#define LINE_PIXELS_PER_CM_HEIGHT 12.0f  // –ü–∏–∫—Å–µ–ª–µ–π –Ω–∞ 1 —Å–º –ø–æ –≤—ã—Å–æ—Ç–µ –∫–∞–¥—Ä–∞
#define LINE_WIDTH_MM 19.5f              // –®–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏ –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö (19-20–º–º)
```

### –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–ù–∞ –æ—Å–Ω–æ–≤–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è:

```cpp
#define LINE_WIDTH_CM (LINE_WIDTH_MM / 10.0f)  // –®–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏ –≤ —Å–º
#define LINE_EXPECTED_WIDTH_PIXELS_H (LINE_WIDTH_CM * LINE_PIXELS_PER_CM_WIDTH)   // –û–∂–∏–¥–∞–µ–º–∞—è —à–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (~31 –ø–∏–∫—Å)
#define LINE_EXPECTED_WIDTH_PIXELS_V (LINE_WIDTH_CM * LINE_PIXELS_PER_CM_HEIGHT)  // –û–∂–∏–¥–∞–µ–º–∞—è —à–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ (~23 –ø–∏–∫—Å)
```

## –ü—Ä–æ—Ü–µ—Å—Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –†–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ —Ç—Ä–∞—Å—Å—É —Å —á–µ—Ä–Ω–æ–π –ª–∏–Ω–∏–µ–π —à–∏—Ä–∏–Ω–æ–π 19-20 –º–º
2. –†–∞—Å–ø–æ–ª–æ–∂–∏—Ç–µ —Ä–æ–±–æ—Ç–∞ –Ω–∞ —Ç—Ä–∞—Å—Å–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–∞–º–µ—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–Ω–∏–∑ –ø–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —É–≥–ª–æ–º

### 2. –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞

1. –ó–∞—Ö–≤–∞—Ç–∏—Ç–µ –∫–∞–¥—Ä —Å –∫–∞–º–µ—Ä—ã (160x120 –ø–∏–∫—Å–µ–ª–µ–π)
2. –ò–∑–º–µ—Ä—å—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —à–∏—Ä–∏–Ω—É –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤ –∫–∞–¥—Ä–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –Ω–∏–∂–Ω–µ–π —Å–∫–∞–Ω–∏—Ä—É—é—â–µ–π –ª–∏–Ω–∏–∏ (90% –≤—ã—Å–æ—Ç—ã)
3. –í—ã—á–∏—Å–ª–∏—Ç–µ: `LINE_PIXELS_PER_CM_WIDTH = 160 / —à–∏—Ä–∏–Ω–∞_–≤_—Å–º`

**–ü—Ä–∏–º–µ—Ä:**
- –í–∏–¥–∏–º–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∞–¥—Ä–∞ = 10 —Å–º
- `LINE_PIXELS_PER_CM_WIDTH = 160 / 10 = 16.0`

### 3. –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞

1. –ò–∑–º–µ—Ä—å—Ç–µ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –≤—ã—Å–æ—Ç—É –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤ –∫–∞–¥—Ä–µ
2. –í—ã—á–∏—Å–ª–∏—Ç–µ: `LINE_PIXELS_PER_CM_HEIGHT = 120 / –≤—ã—Å–æ—Ç–∞_–≤_—Å–º`

**–ü—Ä–∏–º–µ—Ä:**
- –í–∏–¥–∏–º–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∞–¥—Ä–∞ = 10 —Å–º
- `LINE_PIXELS_PER_CM_HEIGHT = 120 / 10 = 12.0`

### 4. –ò–∑–º–µ—Ä–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –ª–∏–Ω–∏–∏

1. –ò–∑–º–µ—Ä—å—Ç–µ —à–∏—Ä–∏–Ω—É –ª–∏–Ω–∏–∏ —Ç—Ä–∞—Å—Å—ã –ª–∏–Ω–µ–π–∫–æ–π –∏–ª–∏ —à—Ç–∞–Ω–≥–µ–Ω—Ü–∏—Ä–∫—É–ª–µ–º
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö

**–ü—Ä–∏–º–µ—Ä:**
- –®–∏—Ä–∏–Ω–∞ –ª–∏–Ω–∏–∏ = 19.5 –º–º
- `LINE_WIDTH_MM = 19.5`

## –ö–∞–∫ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∏—Ä–∏–Ω—ã –ª–∏–Ω–∏–∏

–ö–∞–∂–¥—ã–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫–∞–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–∂–∏–¥–∞–µ–º–æ–π —à–∏—Ä–∏–Ω–µ –ª–∏–Ω–∏–∏:

```cpp
float expected_pixels = LINE_EXPECTED_WIDTH_PIXELS_H;  // ~31 –ø–∏–∫—Å –¥–ª—è –ª–∏–Ω–∏–∏ 19.5–º–º
float width_ratio = (float)detected_pixels / expected_pixels;
```

### 2. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (confidence)

–ù–∞ –æ—Å–Ω–æ–≤–µ `width_ratio` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0.0, 1.0]:

- **width_ratio ‚âà 1.0** ‚Üí –≤—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–ª–∏–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã)
- **width_ratio < 0.3** ‚Üí –Ω–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (—Å–ª–∏—à–∫–æ–º —É–∑–∫–∞—è, –º–æ–∂–µ—Ç –±—ã—Ç—å —à—É–º)
- **width_ratio > 2.0** ‚Üí –Ω–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (—Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∞—è, –º–æ–∂–µ—Ç –±—ã—Ç—å T-–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ)

### 3. –í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –ª–∏–Ω–∏–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å —É—á–µ—Ç–æ–º —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏:

```cpp
// –°–∫–∞–Ω—ã —Å –≤—ã—Å–æ–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å
float weighted_trend = max_trend * avg_confidence;
float trend_weight = 0.3f * (1.0f + max_trend_confidence);  // 0.3 - 0.6
```

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ PID —Ä–µ–≥—É–ª—è—Ç–æ—Ä

–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ —É–ª—É—á—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å PID —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞ —Å—á–µ—Ç:

1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —à—É–º–∞**: –û–±—ä–µ–∫—Ç—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
2. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞–¥–µ–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**: –°–∫–∞–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω–æ–π –ª–∏–Ω–∏–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å
3. **–£–ª—É—á—à–µ–Ω–Ω–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤**: –¢—Ä–µ–Ω–¥ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å

–†–µ–∑—É–ª—å—Ç–∞—Ç: –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–µ –∏ —Ç–æ—á–Ω–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ –ª–∏–Ω–∏–∏.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–∞–ª–∏–±—Ä–æ–≤–∞—Ç—å

- –ò–∑–º–µ–Ω–∏–ª–∞—Å—å –≤—ã—Å–æ—Ç–∞ –∫–∞–º–µ—Ä—ã –Ω–∞–¥ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é
- –ò–∑–º–µ–Ω–∏–ª—Å—è —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∞—Å—Å–∞ —Å –¥—Ä—É–≥–æ–π —à–∏—Ä–∏–Ω–æ–π –ª–∏–Ω–∏–∏
- –ö–∞–º–µ—Ä–∞ –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å

### –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ï—Å–ª–∏ —Ä–æ–±–æ—Ç —Å–ª–∏—à–∫–æ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —à—É–º—É:
- –£–º–µ–Ω—å—à–∏—Ç–µ –¥–æ–ø—É—Å–∫ –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (tolerance_factor –≤ –∫–æ–¥–µ)

–ï—Å–ª–∏ —Ä–æ–±–æ—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —É–∑–∫–∏–µ —É—á–∞—Å—Ç–∫–∏ –ª–∏–Ω–∏–∏:
- –£–º–µ–Ω—å—à–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ (min_pixels –≤ –∫–æ–¥–µ)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏ –ª–∏–Ω–∏–∏:

```bash
cd test
python3 test_line_detection.py
```

–í –≤—ã–≤–æ–¥–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- **–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (confidence)**: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 0.5 –¥–ª—è –ø—Ä—è–º—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
- **–®–∏—Ä–∏–Ω–∞ (width_ratio)**: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–ª–∏–∑–∫–∞ –∫ 1.0 –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ —Ç–µ—Å—Ç–∞

```
üì∑ straight_line.jpg:
   –ü–æ–∑–∏—Ü–∏—è: +0.023
   –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞: True
   –®–∏—Ä–∏–Ω–∞: 19.4%
   –¢—Ä–µ–Ω–¥: +0.005
   –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞: –ª–∏–Ω–∏—è 19.5–º–º ‚âà 31.2–ø–∏–∫—Å
   –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–Ω–∏–∑): 0.87 (—à–∏—Ä–∏–Ω–∞ 1.02x)  ‚Üê –•–æ—Ä–æ—à–æ!
   ‚úÖ PASS
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- `test/test_line_detection.py` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
- `include/hardware_config.h` - —Ñ–∞–π–ª —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏
- `src/LinerRobot.cpp` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å –∫–∞–ª–∏–±—Ä–æ–≤–∫–æ–π
